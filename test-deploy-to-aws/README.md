# What is this folder and HOW-TO

IMPORTANT: See [sub-section on create-deploy-role](#step-4-run-bincreate-deploy-iamrolesh) below, for CRITICAL info for Enterprise-environments !!!

<HR/>

Qn: Why this subfolder?<BR/>
Ans: The `../test` folder does LOCAL testing based on `jest`, on the Cloudformation GENERATED (and eventually packaged into the `.whl` deployable for Python-CDK Construct)

If you customize anything in here -- to state the obvious -- we need to deploy the UPDATED CDK-Construct onto AWS, ..<BR/>
.. to verify nothing broke when we changed the code here.

That's what this sub-folder `test-deploy-to-aws` is all about.

# Step  - Pre-Requisite: In Parent folder

Attention: You must be in the PARENT folder (of this README) to run the following command.

```bash
npm run build
```

# Step 1: `cd ./test-deploy-to-aws`

# Step 2: `.  ./bin/init.sh`

This will UTILIZE the updated CDK-Construct, and generate the `cdk.out` representing a deployable STACK.<BR>
This stack is very minimal:
1. Contains a dummy bucket
1. Contains the AWS-Resources createad by `ServerlessClamscan` Construct.
Nothing more.

# Step 3: Update `bin/common-settings.sh`

This is a must-do.

# Step 4: Run `./bin/create-deploy-iamrole.sh`

This creates an IAM-role that is --used-- by the (following) `bin/deploy.sh` script, to deploy cloudformation.

There are 2 objectives of NOT relying on you utilizing your FULL-ADMIN privileges.

1. The obvious: Principle of Least Privilege.  Something you see all the time on AWS Documentation.
1. In enterprise-scenarios, people need to know what privileges are needed to:
    1.  to create this construct.
    1.  to update this construct.
    1.  to destroy this construct.

# Step 5: Run `./bin/deploy.sh`

<HR/>
<HR/>
<HR/>
<HR/>

# Appendix: Justification for contents of IAM-Role.

Re: [IAM-Role JSON file](./etc/cdk-deploy-iam-role-CFT.json)

Here's the errors that lead to the Access-Statements in it.

```
CdkStack: deploying... [1/1]
CdkStack: creating CloudFormation changeset...

 ‚ùå  CdkStack failed: AccessDenied: User: arn:aws:sts::591580567012:assumed-role/cdk-hnb659fds-deploy-role-591580567012-us-east-2/aws-cdk-test is not authorized to perform: iam:PassRole on resource: arn:aws:iam::591580567012:role/ClamAV-Malware-Scanner_CDK-Deploy because no identity-based policy allows the iam:PassRole action
```

# EoF
